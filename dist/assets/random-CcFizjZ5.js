import{a as K,j as i,r as d,R as p,b as z}from"./index-CXctJ39y.js";const ce=()=>{var s;const{status:t,reload:e}=K();return!t.partial&&!t.error?null:i.jsxs("div",{className:"card",role:"status","aria-live":"polite",style:{marginBottom:12},children:[t.error?i.jsx("div",{className:"error",children:"Some data failed to load. The app is using fallback datasets."}):i.jsx("div",{className:"notice",children:"Running with partial data (fallbacks)."}),i.jsxs("div",{style:{fontSize:12,opacity:.8},children:["Details: ",(s=t.details)==null?void 0:s.join(", ")]}),i.jsx("div",{style:{marginTop:8},children:i.jsx("button",{onClick:e,children:"Retry loading"})})]})};function H(t,e,s=5){const[n,a]=d.useState(-1);d.useEffect(()=>{a(-1)},[e]);const r=d.useMemo(()=>{if(!e||e.length<2)return[];const u=e.toLowerCase().trim(),x=[];for(const f of t){const w=f.displayName.toLowerCase(),v=f.firstName.toLowerCase(),b=f.lastName.toLowerCase();let m=0;w===u?m=1e3:w.startsWith(u)?m=900:b.startsWith(u)?m=800:v.startsWith(u)?m=700:w.includes(u)?m=600:b.includes(u)?m=500:f.aliases&&f.aliases.find(N=>N.toLowerCase().includes(u))&&(m=400),m>0&&x.push({player:f,score:m})}return x.sort((f,w)=>w.score!==f.score?w.score-f.score:f.player.displayName.localeCompare(w.player.displayName)),x.slice(0,s).map(f=>f.player)},[t,e,s]),o=d.useCallback(()=>{a(u=>r.length===0?-1:u<r.length-1?u+1:u)},[r.length]),l=d.useCallback(()=>{a(u=>r.length===0?-1:u>-1?u-1:-1)},[r.length]),y=d.useCallback(()=>n>=0&&n<r.length?r[n]:null,[n,r]),c=d.useCallback(()=>{a(-1)},[]);return{suggestions:r,selectedIndex:n,selectNext:o,selectPrevious:l,getSelectedPlayer:y,reset:c,hasSuggestions:r.length>0}}const W=({suggestions:t,selectedIndex:e,onSelect:s,visible:n})=>{const a=d.useRef(null),r=d.useRef(null);return d.useEffect(()=>{r.current&&r.current.scrollIntoView({block:"nearest",behavior:"smooth"})},[e]),!n||t.length===0?null:i.jsx("div",{ref:a,className:"suggestions-dropdown",role:"listbox","aria-label":"Player suggestions",style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:"var(--bg, #fff)",border:"1px solid var(--border, #ddd)",borderRadius:"4px",marginTop:"4px",maxHeight:"300px",overflowY:"auto",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:1e3},children:t.map((o,l)=>{const y=l===e;return i.jsxs("button",{ref:y?r:null,type:"button",role:"option","aria-selected":y,onClick:()=>s(o),onMouseEnter:c=>{c.currentTarget,document.activeElement},style:{width:"100%",padding:"10px 12px",border:"none",borderBottom:l<t.length-1?"1px solid var(--border, #eee)":"none",backgroundColor:y?"var(--accent, #007bff)":"transparent",color:y?"#fff":"var(--text, #333)",textAlign:"left",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"background-color 0.15s ease",fontFamily:"inherit",fontSize:"14px"},onMouseDown:c=>{c.preventDefault()},children:[i.jsx("span",{style:{fontWeight:500},children:o.displayName}),i.jsxs("span",{style:{fontSize:"12px",opacity:.7,marginLeft:"8px"},children:[o.position,o.team&&` • ${o.team}`]})]},o.id)})})},le=({disabled:t,onSubmitGuess:e,players:s=[]})=>{const[n,a]=p.useState(""),[r,o]=d.useState(!1),l=d.useRef(null),y=d.useRef(null),{suggestions:c,selectedIndex:u,selectNext:x,selectPrevious:f,getSelectedPlayer:w,reset:v,hasSuggestions:b}=H(s,n),m=p.useCallback(h=>{h.trim()&&(e(h),a(""),v(),o(!1))},[e,v]),L=p.useCallback(h=>{h.preventDefault();const S=w();m(S?S.displayName:n)},[n,w,m]),N=p.useCallback(h=>{if(!(!b||!r))switch(h.key){case"ArrowDown":h.preventDefault(),x();break;case"ArrowUp":h.preventDefault(),f();break;case"Escape":h.preventDefault(),o(!1),v();break;case"Tab":if(u>=0){h.preventDefault();const S=w();S&&(a(S.displayName),o(!1),v())}break}},[b,r,x,f,u,w,v]),P=p.useCallback(h=>{const S=h.target.value;a(S),S.length>=2&&s.length>0?o(!0):o(!1)},[s.length]),O=p.useCallback(()=>{n.length>=2&&b&&o(!0)},[n.length,b]),$=p.useCallback(()=>{setTimeout(()=>{o(!1)},200)},[]),F=p.useCallback(h=>{var S;a(h.displayName),o(!1),v(),(S=l.current)==null||S.focus(),m(h.displayName)},[v,m]);return i.jsxs("div",{ref:y,style:{position:"relative",flex:1},children:[i.jsxs("form",{onSubmit:L,className:"row","aria-label":"Guess form",children:[i.jsx("input",{ref:l,id:"guess-input",type:"text","aria-label":"Enter your guess","aria-autocomplete":"list","aria-controls":"player-suggestions","aria-expanded":r&&b,placeholder:"Type a player name…",value:n,onChange:P,onKeyDown:N,onFocus:O,onBlur:$,disabled:t,autoComplete:"off"}),i.jsx("button",{type:"submit",disabled:t,children:"Guess"})]}),i.jsx(W,{suggestions:c,selectedIndex:u,onSelect:F,visible:r})]})},ue=({disabled:t,onHint:e,onGiveUp:s})=>i.jsxs("div",{className:"row",children:[i.jsx("button",{onClick:e,disabled:t,"aria-disabled":t,children:"Hint (-1)"}),i.jsx("button",{onClick:s,disabled:t,"aria-disabled":t,children:"Give Up"})]}),de=({enabled:t,onSubmit:e,onHint:s,onGiveUp:n})=>(p.useEffect(()=>{if(!t)return;const a=p.useCallback(r=>{if(r.key==="Enter"&&e(),r.key.toLowerCase()==="h"&&s(),r.key.toLowerCase()==="g"&&n(),r.key==="/"){const o=document.getElementById("guess-input");o==null||o.focus(),r.preventDefault()}},[e,s,n]);return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[t,e,s,n]),i.jsxs("div",{style:{fontSize:12,opacity:.7},children:["Shortcuts: ",i.jsx("kbd",{children:"/"})," focus, ",i.jsx("kbd",{children:"Enter"})," submit, ",i.jsx("kbd",{children:"H"})," hint, ",i.jsx("kbd",{children:"G"})," give up."]}));function X(){const[t,e]=d.useState(Date.now()),s=d.useRef(!1),n=d.useRef(null);d.useEffect(()=>{const r=()=>{s.current=document.hidden,document.hidden||a()};return document.addEventListener("visibilitychange",r),()=>document.removeEventListener("visibilitychange",r)},[]);function a(){e(Date.now()),n.current=window.setTimeout(a,1e3)}return d.useEffect(()=>(a(),()=>{n.current&&clearTimeout(n.current)}),[]),[t,document.hidden]}const fe=({deadlineMs:t,onTimeout:e})=>{const[s,n]=p.useState(0),[,a]=X(),r=p.useRef(e);return r.current=e,z(p.useCallback(o=>{if(a)return;const l=Math.max(0,Math.floor((t-o)/1e3));n(l),l<=0&&r.current()},[t,a]),!0),p.useEffect(()=>{const o=Date.now(),l=Math.max(0,Math.floor((t-o)/1e3));n(l)},[t]),i.jsxs("div",{"aria-live":"polite","aria-atomic":"true",children:["⏱️ Time left: ",i.jsxs("strong",{children:[s,"s"]})]})};function Q(t=new Date){var e,s,n;try{const r=new Intl.DateTimeFormat("en-US",{timeZone:"America/Chicago",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(t),o=((e=r.find(c=>c.type==="year"))==null?void 0:e.value)??String(t.getUTCFullYear()),l=((s=r.find(c=>c.type==="month"))==null?void 0:s.value)??String(t.getUTCMonth()+1).padStart(2,"0"),y=((n=r.find(c=>c.type==="day"))==null?void 0:n.value)??String(t.getUTCDate()).padStart(2,"0");return`${o}-${l}-${y}`}catch{const a=t.getUTCFullYear(),r=String(t.getUTCMonth()+1).padStart(2,"0"),o=String(t.getUTCDate()).padStart(2,"0");return`${a}-${r}-${o}`}}const J=60;function me(t=new Date){return Q(t)}const U=3,V=5,E=10,R=0,Y=100;class Z{now(){return Date.now()}}let D=new Z;class g extends Error{constructor(e,s,n,a){super(e),this.code=s,this.currentState=n,this.action=a,this.name="GameStateError"}}function q(t){if(!t||typeof t!="object")return!1;const e=t;switch(e.type){case"start":case"hint":case"reset":return!0;case"tick":return typeof e.nowMs=="number"&&Number.isFinite(e.nowMs)&&e.nowMs>0;case"guess":return typeof e.text=="string"&&e.text.trim().length>0;case"reveal":return typeof e.reason=="string"&&["giveup","maxGuesses","timeout","solved"].includes(e.reason);default:return!1}}function I(t){if(!t||typeof t!="object")return!1;const e=t;if(typeof e.tag!="string")return!1;switch(e.tag){case"idle":return!0;case"active":return typeof e.startedAtMs=="number"&&typeof e.deadlineMs=="number"&&Array.isArray(e.guesses)&&e.guesses.every(s=>typeof s=="string")&&e.guesses.length<=U&&typeof e.hintsUsed=="number"&&e.hintsUsed>=0&&e.hintsUsed<=V&&typeof e.score=="number"&&e.score>=R&&e.score<=E&&e.startedAtMs>0&&e.deadlineMs>e.startedAtMs;case"revealed":return typeof e.endedAtMs=="number"&&typeof e.reason=="string"&&["giveup","maxGuesses","timeout","solved"].includes(e.reason)&&typeof e.finalScore=="number"&&e.finalScore>=R&&e.finalScore<=E&&Array.isArray(e.guesses)&&e.guesses.every(s=>typeof s=="string")&&typeof e.hintsUsed=="number"&&e.hintsUsed>=0&&e.endedAtMs>0;default:return!1}}function ee(t){return t.trim().slice(0,Y).replace(/\s+/g," ")}function C(t){return Math.max(R,Math.min(E,Math.floor(t)))}function te(){return{tag:"idle"}}function he(t,e){if(!I(t))throw new g("Invalid state provided to reducer","INVALID_STATE",t,e);if(!q(e))throw new g("Invalid action provided to reducer","INVALID_ACTION",t,e);try{switch(t.tag){case"idle":{if(e.type==="start"){const s=D.now(),n={tag:"active",startedAtMs:s,deadlineMs:s+J*1e3,guesses:[],hintsUsed:0,score:5};if(!I(n))throw new g("Generated invalid active state","INVALID_STATE",t,e);return n}if(e.type!=="reset")throw new g(`Invalid action '${e.type}' for idle state`,"INVALID_TRANSITION",t,e);return t}case"active":{if(e.type==="tick"){if(e.nowMs<t.startedAtMs)throw new g("Tick time cannot be before game start","INVALID_ACTION",t,e);if(e.nowMs>=t.deadlineMs){const s={tag:"revealed",endedAtMs:e.nowMs,reason:"timeout",finalScore:C(t.score-1),guesses:[...t.guesses],hintsUsed:t.hintsUsed};if(!I(s))throw new g("Generated invalid revealed state from timeout","INVALID_STATE",t,e);return s}return t}if(e.type==="guess"){const s=ee(e.text);if(t.guesses.includes(s))return t;const n=[...t.guesses,s];if(n.length>=U){const r={tag:"revealed",endedAtMs:D.now(),reason:"maxGuesses",finalScore:C(t.score-1),guesses:n,hintsUsed:t.hintsUsed};if(!I(r))throw new g("Generated invalid revealed state from max guesses","INVALID_STATE",t,e);return r}const a={...t,guesses:n};if(!I(a))throw new g("Generated invalid active state after guess","INVALID_STATE",t,e);return a}if(e.type==="hint"){if(t.hintsUsed>=V)return t;const s={...t,hintsUsed:t.hintsUsed+1,score:C(t.score-1)};if(!I(s))throw new g("Generated invalid active state after hint","INVALID_STATE",t,e);return s}if(e.type==="reveal"){const s={tag:"revealed",endedAtMs:D.now(),reason:e.reason,finalScore:C(t.score),guesses:[...t.guesses],hintsUsed:t.hintsUsed};if(!I(s))throw new g("Generated invalid revealed state from manual reveal","INVALID_STATE",t,e);return s}throw new g(`Invalid action '${e.type}' for active state`,"INVALID_TRANSITION",t,e)}case"revealed":{if(e.type==="reset")return te();throw new g(`Invalid action '${e.type}' for revealed state`,"INVALID_TRANSITION",t,e)}default:{const s=t;throw new g(`Unknown state tag: ${s.tag}`,"INVALID_STATE",t,e)}}}catch(s){throw s instanceof g?s:new g(`Unexpected error in reducer: ${s}`,"INVALID_STATE",t,e)}}const G=3,_=`njt_v${G}_`,k=new Map,se=5*60*1e3,M={recentIds:[],streakBest:0,streakCurrent:0,lastDailyKey:void 0,lastDailyId:void 0,lastPosition:void 0,gameStats:{totalGames:0,totalCorrect:0,averageScore:0,bestStreak:0,positionStats:{QB:{games:0,correct:0},RB:{games:0,correct:0},WR:{games:0,correct:0},TE:{games:0,correct:0}}},preferences:{soundEnabled:!0,animationsEnabled:!0,theme:"auto"},performanceMetrics:{averageGuessTime:0,fastestGuess:1/0,totalGuesses:0}};function B(t){return`${_}${t}`}function re(t){const e=B(t),s=k.get(e);return s?Date.now()>s.timestamp+s.ttl?(k.delete(e),null):s.data:null}function j(t,e,s=se){const n=B(t);if(k.set(n,{data:e,timestamp:Date.now(),ttl:s}),k.size>100){const a=Date.now();for(const[r,o]of k.entries())a>o.timestamp+o.ttl&&k.delete(r)}}function ne(t){return JSON.stringify(t)}function ae(t){return JSON.parse(t)}function T(){const t=re("state");if(t)return t;try{const s=localStorage.getItem(_+"state");if(s){const n=ae(s),a={...M,...typeof n=="object"&&n!==null?n:{}};return j("state",a),a}for(let n=G-1;n>=1;n--){const a=localStorage.getItem(`njt_v${n}_state`);if(a){const r=JSON.parse(a),o={...M,recentIds:r.recentIds??r.njt_recent_ids??[],streakBest:r.streakBest??r.njt_streak_best??0,streakCurrent:r.streakCurrent??r.njt_streak_current??0,lastDailyKey:r.lastDailyKey,lastDailyId:r.lastDailyId,lastPosition:r.lastPosition};return A(o),o}}}catch(s){console.warn("Failed to load state from storage:",s)}const e={...M};return j("state",e),e}function A(t){try{const s={...T(),...t},n=ne(s);localStorage.setItem(_+"state",n),j("state",s)}catch(e){console.warn("Failed to save state to storage:",e)}}function ge(t,e,s,n){const a=T(),r=a.gameStats;if(r.totalGames++,e&&(r.totalCorrect++,r.positionStats[t].correct++),r.positionStats[t].games++,r.averageScore=(r.averageScore*(r.totalGames-1)+s)/r.totalGames,n&&n>0){const o=a.performanceMetrics;o.totalGuesses++,o.averageGuessTime=(o.averageGuessTime*(o.totalGuesses-1)+n)/o.totalGuesses,o.fastestGuess=Math.min(o.fastestGuess,n)}A({gameStats:r,performanceMetrics:a.performanceMetrics})}function pe(t){const e=T();return t?(e.streakCurrent++,e.streakBest=Math.max(e.streakBest,e.streakCurrent)):e.streakCurrent=0,A({streakCurrent:e.streakCurrent,streakBest:e.streakBest}),{current:e.streakCurrent,best:e.streakBest}}function ye(t,e=50){const s=T(),n=[t,...s.recentIds.filter(a=>a!==t)].slice(0,e);A({recentIds:n})}function oe(){try{for(let t=1;t<G;t++){const e=`njt_v${t}_state`;localStorage.removeItem(e)}}catch(t){console.warn("Failed to cleanup old storage versions:",t)}}oe();function we(t){if(t<=0)return 0;if(crypto&&"getRandomValues"in crypto){const e=new Uint32Array(1);crypto.getRandomValues(e);const s=e[0];if(s!==void 0)return s%t}return Math.floor(Math.random()*t)}function Se(t,e){let s=2166136261;for(let a=0;a<e.length;a++)s^=e.charCodeAt(a),s=Math.imul(s,16777619);s^=s<<13,s^=s>>>17,s^=s<<5;const n=(s>>>0)/4294967296;return Math.floor(n*t)}function ve(t,e){var y;const s=["QB","RB","WR","TE"],n=e[e.length-1],a=Math.max(0,s.indexOf(n??"QB")),r=s.slice(a+1).concat(s.slice(0,a+1)),o=new Map;for(const c of s)o.set(c,[]);for(const c of t)(y=o.get(c.position))==null||y.push(c);const l=[];for(const c of r)l.push(...o.get(c)??[]);return l.length?l:t}export{ce as D,le as G,ue as H,de as K,fe as T,pe as a,ye as b,ve as c,we as d,Q as e,me as f,Se as g,te as i,T as l,he as r,A as s,ge as u};
