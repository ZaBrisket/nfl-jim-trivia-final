import{a as C,j as i,R as d,r as h,b}from"./index-ApU95X6B.js";const z=()=>{var s;const{status:t,reload:e}=C();return!t.partial&&!t.error?null:i.jsxs("div",{className:"card",role:"status","aria-live":"polite",style:{marginBottom:12},children:[t.error?i.jsx("div",{className:"error",children:"Some data failed to load. The app is using fallback datasets."}):i.jsx("div",{className:"notice",children:"Running with partial data (fallbacks)."}),i.jsxs("div",{style:{fontSize:12,opacity:.8},children:["Details: ",(s=t.details)==null?void 0:s.join(", ")]}),i.jsx("div",{style:{marginTop:8},children:i.jsx("button",{onClick:e,children:"Retry loading"})})]})},H=({disabled:t,onSubmitGuess:e})=>{const[s,r]=d.useState(""),a=d.useCallback(n=>{n.preventDefault(),s.trim()&&(e(s),r(""))},[e,s]);return i.jsxs("form",{onSubmit:a,className:"row","aria-label":"Guess form",children:[i.jsx("input",{id:"guess-input",type:"text","aria-label":"Enter your guess",placeholder:"Type a player name…",value:s,onChange:n=>r(n.target.value),disabled:t}),i.jsx("button",{type:"submit",disabled:t,children:"Guess"})]})},X=({disabled:t,onHint:e,onGiveUp:s})=>i.jsxs("div",{className:"row",children:[i.jsx("button",{onClick:e,disabled:t,"aria-disabled":t,children:"Hint (-1)"}),i.jsx("button",{onClick:s,disabled:t,"aria-disabled":t,children:"Give Up"})]}),J=({enabled:t,onSubmit:e,onHint:s,onGiveUp:r})=>(d.useEffect(()=>{if(!t)return;const a=d.useCallback(n=>{if(n.key==="Enter"&&e(),n.key.toLowerCase()==="h"&&s(),n.key.toLowerCase()==="g"&&r(),n.key==="/"){const o=document.getElementById("guess-input");o==null||o.focus(),n.preventDefault()}},[e,s,r]);return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[t,e,s,r]),i.jsxs("div",{style:{fontSize:12,opacity:.7},children:["Shortcuts: ",i.jsx("kbd",{children:"/"})," focus, ",i.jsx("kbd",{children:"Enter"})," submit, ",i.jsx("kbd",{children:"H"})," hint, ",i.jsx("kbd",{children:"G"})," give up."]}));function N(){const[t,e]=h.useState(Date.now()),s=h.useRef(!1),r=h.useRef(null);h.useEffect(()=>{const n=()=>{s.current=document.hidden,document.hidden||a()};return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)},[]);function a(){e(Date.now()),r.current=window.setTimeout(a,1e3)}return h.useEffect(()=>(a(),()=>{r.current&&clearTimeout(r.current)}),[]),[t,document.hidden]}const Q=({deadlineMs:t,onTimeout:e})=>{const[s,r]=d.useState(0),[,a]=N(),n=d.useRef(e);return n.current=e,b(d.useCallback(o=>{if(a)return;const l=Math.max(0,Math.floor((t-o)/1e3));r(l),l<=0&&n.current()},[t,a]),!0),d.useEffect(()=>{const o=Date.now(),l=Math.max(0,Math.floor((t-o)/1e3));r(l)},[t]),i.jsxs("div",{"aria-live":"polite","aria-atomic":"true",children:["⏱️ Time left: ",i.jsxs("strong",{children:[s,"s"]})]})};function G(t=new Date){var e,s,r;try{const n=new Intl.DateTimeFormat("en-US",{timeZone:"America/Chicago",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(t),o=((e=n.find(u=>u.type==="year"))==null?void 0:e.value)??String(t.getUTCFullYear()),l=((s=n.find(u=>u.type==="month"))==null?void 0:s.value)??String(t.getUTCMonth()+1).padStart(2,"0"),g=((r=n.find(u=>u.type==="day"))==null?void 0:r.value)??String(t.getUTCDate()).padStart(2,"0");return`${o}-${l}-${g}`}catch{const a=t.getUTCFullYear(),n=String(t.getUTCMonth()+1).padStart(2,"0"),o=String(t.getUTCDate()).padStart(2,"0");return`${a}-${n}-${o}`}}const _=60;function W(t=new Date){return G(t)}const D=3,x=5,I=10,T=0,R=100;class j{now(){return Date.now()}}let v=new j;class c extends Error{constructor(e,s,r,a){super(e),this.code=s,this.currentState=r,this.action=a,this.name="GameStateError"}}function U(t){if(!t||typeof t!="object")return!1;const e=t;switch(e.type){case"start":case"hint":case"reset":return!0;case"tick":return typeof e.nowMs=="number"&&Number.isFinite(e.nowMs)&&e.nowMs>0;case"guess":return typeof e.text=="string"&&e.text.trim().length>0;case"reveal":return typeof e.reason=="string"&&["giveup","maxGuesses","timeout","solved"].includes(e.reason);default:return!1}}function f(t){if(!t||typeof t!="object")return!1;const e=t;if(typeof e.tag!="string")return!1;switch(e.tag){case"idle":return!0;case"active":return typeof e.startedAtMs=="number"&&typeof e.deadlineMs=="number"&&Array.isArray(e.guesses)&&e.guesses.every(s=>typeof s=="string")&&e.guesses.length<=D&&typeof e.hintsUsed=="number"&&e.hintsUsed>=0&&e.hintsUsed<=x&&typeof e.score=="number"&&e.score>=T&&e.score<=I&&e.startedAtMs>0&&e.deadlineMs>e.startedAtMs;case"revealed":return typeof e.endedAtMs=="number"&&typeof e.reason=="string"&&["giveup","maxGuesses","timeout","solved"].includes(e.reason)&&typeof e.finalScore=="number"&&e.finalScore>=T&&e.finalScore<=I&&Array.isArray(e.guesses)&&e.guesses.every(s=>typeof s=="string")&&typeof e.hintsUsed=="number"&&e.hintsUsed>=0&&e.endedAtMs>0;default:return!1}}function L(t){return t.trim().slice(0,R).replace(/\s+/g," ")}function p(t){return Math.max(T,Math.min(I,Math.floor(t)))}function V(){return{tag:"idle"}}function Y(t,e){if(!f(t))throw new c("Invalid state provided to reducer","INVALID_STATE",t,e);if(!U(e))throw new c("Invalid action provided to reducer","INVALID_ACTION",t,e);try{switch(t.tag){case"idle":{if(e.type==="start"){const s=v.now(),r={tag:"active",startedAtMs:s,deadlineMs:s+_*1e3,guesses:[],hintsUsed:0,score:5};if(!f(r))throw new c("Generated invalid active state","INVALID_STATE",t,e);return r}if(e.type!=="reset")throw new c(`Invalid action '${e.type}' for idle state`,"INVALID_TRANSITION",t,e);return t}case"active":{if(e.type==="tick"){if(e.nowMs<t.startedAtMs)throw new c("Tick time cannot be before game start","INVALID_ACTION",t,e);if(e.nowMs>=t.deadlineMs){const s={tag:"revealed",endedAtMs:e.nowMs,reason:"timeout",finalScore:p(t.score-1),guesses:[...t.guesses],hintsUsed:t.hintsUsed};if(!f(s))throw new c("Generated invalid revealed state from timeout","INVALID_STATE",t,e);return s}return t}if(e.type==="guess"){const s=L(e.text);if(t.guesses.includes(s))return t;const r=[...t.guesses,s];if(r.length>=D){const n={tag:"revealed",endedAtMs:v.now(),reason:"maxGuesses",finalScore:p(t.score-1),guesses:r,hintsUsed:t.hintsUsed};if(!f(n))throw new c("Generated invalid revealed state from max guesses","INVALID_STATE",t,e);return n}const a={...t,guesses:r};if(!f(a))throw new c("Generated invalid active state after guess","INVALID_STATE",t,e);return a}if(e.type==="hint"){if(t.hintsUsed>=x)return t;const s={...t,hintsUsed:t.hintsUsed+1,score:p(t.score-1)};if(!f(s))throw new c("Generated invalid active state after hint","INVALID_STATE",t,e);return s}if(e.type==="reveal"){const s={tag:"revealed",endedAtMs:v.now(),reason:e.reason,finalScore:p(t.score),guesses:[...t.guesses],hintsUsed:t.hintsUsed};if(!f(s))throw new c("Generated invalid revealed state from manual reveal","INVALID_STATE",t,e);return s}throw new c(`Invalid action '${e.type}' for active state`,"INVALID_TRANSITION",t,e)}case"revealed":{if(e.type==="reset")return V();throw new c(`Invalid action '${e.type}' for revealed state`,"INVALID_TRANSITION",t,e)}default:{const s=t;throw new c(`Unknown state tag: ${s.tag}`,"INVALID_STATE",t,e)}}}catch(s){throw s instanceof c?s:new c(`Unexpected error in reducer: ${s}`,"INVALID_STATE",t,e)}}const k=3,M=`njt_v${k}_`,m=new Map,B=5*60*1e3,S={recentIds:[],streakBest:0,streakCurrent:0,lastDailyKey:void 0,lastDailyId:void 0,lastPosition:void 0,gameStats:{totalGames:0,totalCorrect:0,averageScore:0,bestStreak:0,positionStats:{QB:{games:0,correct:0},RB:{games:0,correct:0},WR:{games:0,correct:0},TE:{games:0,correct:0}}},preferences:{soundEnabled:!0,animationsEnabled:!0,theme:"auto"},performanceMetrics:{averageGuessTime:0,fastestGuess:1/0,totalGuesses:0}};function E(t){return`${M}${t}`}function O(t){const e=E(t),s=m.get(e);return s?Date.now()>s.timestamp+s.ttl?(m.delete(e),null):s.data:null}function A(t,e,s=B){const r=E(t);if(m.set(r,{data:e,timestamp:Date.now(),ttl:s}),m.size>100){const a=Date.now();for(const[n,o]of m.entries())a>o.timestamp+o.ttl&&m.delete(n)}}function $(t){return JSON.stringify(t)}function F(t){return JSON.parse(t)}function y(){const t=O("state");if(t)return t;try{const s=localStorage.getItem(M+"state");if(s){const r=F(s),a={...S,...typeof r=="object"&&r!==null?r:{}};return A("state",a),a}for(let r=k-1;r>=1;r--){const a=localStorage.getItem(`njt_v${r}_state`);if(a){const n=JSON.parse(a),o={...S,recentIds:n.recentIds??n.njt_recent_ids??[],streakBest:n.streakBest??n.njt_streak_best??0,streakCurrent:n.streakCurrent??n.njt_streak_current??0,lastDailyKey:n.lastDailyKey,lastDailyId:n.lastDailyId,lastPosition:n.lastPosition};return w(o),o}}}catch(s){console.warn("Failed to load state from storage:",s)}const e={...S};return A("state",e),e}function w(t){try{const s={...y(),...t},r=$(s);localStorage.setItem(M+"state",r),A("state",s)}catch(e){console.warn("Failed to save state to storage:",e)}}function Z(t,e,s,r){const a=y(),n=a.gameStats;if(n.totalGames++,e&&(n.totalCorrect++,n.positionStats[t].correct++),n.positionStats[t].games++,n.averageScore=(n.averageScore*(n.totalGames-1)+s)/n.totalGames,r&&r>0){const o=a.performanceMetrics;o.totalGuesses++,o.averageGuessTime=(o.averageGuessTime*(o.totalGuesses-1)+r)/o.totalGuesses,o.fastestGuess=Math.min(o.fastestGuess,r)}w({gameStats:n,performanceMetrics:a.performanceMetrics})}function q(t){const e=y();return t?(e.streakCurrent++,e.streakBest=Math.max(e.streakBest,e.streakCurrent)):e.streakCurrent=0,w({streakCurrent:e.streakCurrent,streakBest:e.streakBest}),{current:e.streakCurrent,best:e.streakBest}}function ee(t,e=50){const s=y(),r=[t,...s.recentIds.filter(a=>a!==t)].slice(0,e);w({recentIds:r})}function P(){try{for(let t=1;t<k;t++){const e=`njt_v${t}_state`;localStorage.removeItem(e)}}catch(t){console.warn("Failed to cleanup old storage versions:",t)}}P();function te(t){if(t<=0)return 0;if(crypto&&"getRandomValues"in crypto){const e=new Uint32Array(1);crypto.getRandomValues(e);const s=e[0];if(s!==void 0)return s%t}return Math.floor(Math.random()*t)}function se(t,e){let s=2166136261;for(let a=0;a<e.length;a++)s^=e.charCodeAt(a),s=Math.imul(s,16777619);s^=s<<13,s^=s>>>17,s^=s<<5;const r=(s>>>0)/4294967296;return Math.floor(r*t)}function re(t,e){var g;const s=["QB","RB","WR","TE"],r=e[e.length-1],a=Math.max(0,s.indexOf(r??"QB")),n=s.slice(a+1).concat(s.slice(0,a+1)),o=new Map;for(const u of s)o.set(u,[]);for(const u of t)(g=o.get(u.position))==null||g.push(u);const l=[];for(const u of n)l.push(...o.get(u)??[]);return l.length?l:t}export{z as D,H as G,X as H,J as K,Q as T,q as a,ee as b,re as c,te as d,G as e,W as f,se as g,V as i,y as l,Y as r,w as s,Z as u};
