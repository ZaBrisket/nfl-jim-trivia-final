import{R as u,a as M,j as i,r as h,b as N}from"./index-Bmyd-Enj.js";const z=u.memo(()=>{var r;const{status:e,reload:t}=M();return!e.partial&&!e.error?null:i.jsxs("div",{className:"card",role:"status","aria-live":"polite",style:{marginBottom:12},children:[e.error?i.jsx("div",{className:"error",children:"Some data failed to load. The app is using fallback datasets."}):i.jsx("div",{className:"notice",children:"Running with partial data (fallbacks)."}),i.jsxs("div",{style:{fontSize:12,opacity:.8},children:["Details: ",(r=e.details)==null?void 0:r.join(", ")]}),i.jsx("div",{style:{marginTop:8},children:i.jsx("button",{onClick:t,children:"Retry loading"})})]})}),H=u.memo(({disabled:e,onSubmitGuess:t})=>{const[r,s]=u.useState(""),a=u.useCallback(n=>{n.preventDefault(),r.trim()&&(t(r),s(""))},[t,r]);return i.jsxs("form",{onSubmit:a,className:"row","aria-label":"Guess form",children:[i.jsx("input",{id:"guess-input",type:"text","aria-label":"Enter your guess",placeholder:"Type a player name…",value:r,onChange:n=>s(n.target.value),disabled:e}),i.jsx("button",{type:"submit",disabled:e,children:"Guess"})]})}),X=u.memo(({disabled:e,onHint:t,onGiveUp:r})=>i.jsxs("div",{className:"row",children:[i.jsx("button",{onClick:t,disabled:e,"aria-disabled":e,children:"Hint (-1)"}),i.jsx("button",{onClick:r,disabled:e,"aria-disabled":e,children:"Give Up"})]})),J=u.memo(({enabled:e,onSubmit:t,onHint:r,onGiveUp:s})=>(u.useEffect(()=>{if(!e)return;const a=u.useCallback(n=>{if(n.key==="Enter"&&t(),n.key.toLowerCase()==="h"&&r(),n.key.toLowerCase()==="g"&&s(),n.key==="/"){const o=document.getElementById("guess-input");o==null||o.focus(),n.preventDefault()}},[t,r,s]);return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[e,t,r,s]),i.jsxs("div",{style:{fontSize:12,opacity:.7},children:["Shortcuts: ",i.jsx("kbd",{children:"/"})," focus, ",i.jsx("kbd",{children:"Enter"})," submit, ",i.jsx("kbd",{children:"H"})," hint, ",i.jsx("kbd",{children:"G"})," give up."]})));function b(){const[e,t]=h.useState(Date.now()),r=h.useRef(!1),s=h.useRef(null);h.useEffect(()=>{const n=()=>{r.current=document.hidden,document.hidden||a()};return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)},[]);function a(){t(Date.now()),s.current=window.setTimeout(a,1e3)}return h.useEffect(()=>(a(),()=>{s.current&&clearTimeout(s.current)}),[]),[e,document.hidden]}const Q=u.memo(({deadlineMs:e,onTimeout:t})=>{const[r,s]=u.useState(0),[,a]=b(),n=u.useRef(t);return n.current=t,N(u.useCallback(o=>{if(a)return;const d=Math.max(0,Math.floor((e-o)/1e3));s(d),d<=0&&n.current()},[e,a]),!0),u.useEffect(()=>{const o=Date.now(),d=Math.max(0,Math.floor((e-o)/1e3));s(d)},[e]),i.jsxs("div",{"aria-live":"polite","aria-atomic":"true",children:["⏱️ Time left: ",i.jsxs("strong",{children:[r,"s"]})]})});function _(e=new Date){var t,r,s;try{const n=new Intl.DateTimeFormat("en-US",{timeZone:"America/Chicago",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(e),o=((t=n.find(l=>l.type==="year"))==null?void 0:t.value)??String(e.getUTCFullYear()),d=((r=n.find(l=>l.type==="month"))==null?void 0:r.value)??String(e.getUTCMonth()+1).padStart(2,"0"),g=((s=n.find(l=>l.type==="day"))==null?void 0:s.value)??String(e.getUTCDate()).padStart(2,"0");return`${o}-${d}-${g}`}catch{const a=e.getUTCFullYear(),n=String(e.getUTCMonth()+1).padStart(2,"0"),o=String(e.getUTCDate()).padStart(2,"0");return`${a}-${n}-${o}`}}const k=60;function W(e=new Date){return _(e)}const D=3,E=5,v=10,S=0,C=100;class R{now(){return Date.now()}}let y=new R;class c extends Error{constructor(t,r,s,a){super(t),this.code=r,this.currentState=s,this.action=a,this.name="GameStateError"}}function j(e){if(!e||typeof e!="object")return!1;const t=e;switch(t.type){case"start":case"hint":case"reset":return!0;case"tick":return typeof t.nowMs=="number"&&Number.isFinite(t.nowMs)&&t.nowMs>0;case"guess":return typeof t.text=="string"&&t.text.trim().length>0;case"reveal":return typeof t.reason=="string"&&["giveup","maxGuesses","timeout","solved"].includes(t.reason);default:return!1}}function f(e){if(!e||typeof e!="object")return!1;const t=e;if(typeof t.tag!="string")return!1;switch(t.tag){case"idle":return!0;case"active":return typeof t.startedAtMs=="number"&&typeof t.deadlineMs=="number"&&Array.isArray(t.guesses)&&t.guesses.every(r=>typeof r=="string")&&t.guesses.length<=D&&typeof t.hintsUsed=="number"&&t.hintsUsed>=0&&t.hintsUsed<=E&&typeof t.score=="number"&&t.score>=S&&t.score<=v&&t.startedAtMs>0&&t.deadlineMs>t.startedAtMs;case"revealed":return typeof t.endedAtMs=="number"&&typeof t.reason=="string"&&["giveup","maxGuesses","timeout","solved"].includes(t.reason)&&typeof t.finalScore=="number"&&t.finalScore>=S&&t.finalScore<=v&&Array.isArray(t.guesses)&&t.guesses.every(r=>typeof r=="string")&&typeof t.hintsUsed=="number"&&t.hintsUsed>=0&&t.endedAtMs>0;default:return!1}}function U(e){return e.trim().slice(0,C).replace(/\s+/g," ")}function p(e){return Math.max(S,Math.min(v,Math.floor(e)))}function G(){return{tag:"idle"}}function Y(e,t){if(!f(e))throw new c("Invalid state provided to reducer","INVALID_STATE",e,t);if(!j(t))throw new c("Invalid action provided to reducer","INVALID_ACTION",e,t);try{switch(e.tag){case"idle":{if(t.type==="start"){const r=y.now(),s={tag:"active",startedAtMs:r,deadlineMs:r+k*1e3,guesses:[],hintsUsed:0,score:5};if(!f(s))throw new c("Generated invalid active state","INVALID_STATE",e,t);return s}if(t.type!=="reset")throw new c(`Invalid action '${t.type}' for idle state`,"INVALID_TRANSITION",e,t);return e}case"active":{if(t.type==="tick"){if(t.nowMs<e.startedAtMs)throw new c("Tick time cannot be before game start","INVALID_ACTION",e,t);if(t.nowMs>=e.deadlineMs){const r={tag:"revealed",endedAtMs:t.nowMs,reason:"timeout",finalScore:p(e.score-1),guesses:[...e.guesses],hintsUsed:e.hintsUsed};if(!f(r))throw new c("Generated invalid revealed state from timeout","INVALID_STATE",e,t);return r}return e}if(t.type==="guess"){const r=U(t.text);if(e.guesses.includes(r))return e;const s=[...e.guesses,r];if(s.length>=D){const n={tag:"revealed",endedAtMs:y.now(),reason:"maxGuesses",finalScore:p(e.score-1),guesses:s,hintsUsed:e.hintsUsed};if(!f(n))throw new c("Generated invalid revealed state from max guesses","INVALID_STATE",e,t);return n}const a={...e,guesses:s};if(!f(a))throw new c("Generated invalid active state after guess","INVALID_STATE",e,t);return a}if(t.type==="hint"){if(e.hintsUsed>=E)return e;const r={...e,hintsUsed:e.hintsUsed+1,score:p(e.score-1)};if(!f(r))throw new c("Generated invalid active state after hint","INVALID_STATE",e,t);return r}if(t.type==="reveal"){const r={tag:"revealed",endedAtMs:y.now(),reason:t.reason,finalScore:p(e.score),guesses:[...e.guesses],hintsUsed:e.hintsUsed};if(!f(r))throw new c("Generated invalid revealed state from manual reveal","INVALID_STATE",e,t);return r}throw new c(`Invalid action '${t.type}' for active state`,"INVALID_TRANSITION",e,t)}case"revealed":{if(t.type==="reset")return G();throw new c(`Invalid action '${t.type}' for revealed state`,"INVALID_TRANSITION",e,t)}default:throw new c(`Unknown state tag: ${e.tag}`,"INVALID_STATE",e,t)}}catch(r){throw r instanceof c?r:new c(`Unexpected error in reducer: ${r}`,"INVALID_STATE",e,t)}}const T=3,A=`njt_v${T}_`,m=new Map,L=5*60*1e3,w={recentIds:[],streakBest:0,streakCurrent:0,lastDailyKey:void 0,lastDailyId:void 0,lastPosition:void 0,gameStats:{totalGames:0,totalCorrect:0,averageScore:0,bestStreak:0,positionStats:{QB:{games:0,correct:0},RB:{games:0,correct:0},WR:{games:0,correct:0},TE:{games:0,correct:0}}},preferences:{soundEnabled:!0,animationsEnabled:!0,theme:"auto"},performanceMetrics:{averageGuessTime:0,fastestGuess:1/0,totalGuesses:0}};function x(e){return`${A}${e}`}function V(e){const t=x(e),r=m.get(t);return r?Date.now()>r.timestamp+r.ttl?(m.delete(t),null):r.data:null}function I(e,t,r=L){const s=x(e);if(m.set(s,{data:t,timestamp:Date.now(),ttl:r}),m.size>100){const a=Date.now();for(const[n,o]of m.entries())a>o.timestamp+o.ttl&&m.delete(n)}}function O(e){return JSON.stringify(e)}function $(e){return JSON.parse(e)}function B(){const e=V("state");if(e)return e;try{const r=localStorage.getItem(A+"state");if(r){const s={...w,...$(r)};return I("state",s),s}for(let s=T-1;s>=1;s--){const a=localStorage.getItem(`njt_v${s}_state`);if(a){const n=JSON.parse(a),o={...w,recentIds:n.recentIds??n.njt_recent_ids??[],streakBest:n.streakBest??n.njt_streak_best??0,streakCurrent:n.streakCurrent??n.njt_streak_current??0,lastDailyKey:n.lastDailyKey,lastDailyId:n.lastDailyId,lastPosition:n.lastPosition};return F(o),o}}}catch(r){console.warn("Failed to load state from storage:",r)}const t={...w};return I("state",t),t}function F(e){try{const r={...B(),...e},s=O(r);localStorage.setItem(A+"state",s),I("state",r)}catch(t){console.warn("Failed to save state to storage:",t)}}function K(){try{for(let e=1;e<T;e++){const t=`njt_v${e}_state`;localStorage.removeItem(t)}}catch(e){console.warn("Failed to cleanup old storage versions:",e)}}K();function Z(e){if(e<=0)return 0;if(crypto&&"getRandomValues"in crypto){const t=new Uint32Array(1);crypto.getRandomValues(t);const r=t[0];if(r!==void 0)return r%e}return Math.floor(Math.random()*e)}function q(e,t){let r=2166136261;for(let a=0;a<t.length;a++)r^=t.charCodeAt(a),r=Math.imul(r,16777619);r^=r<<13,r^=r>>>17,r^=r<<5;const s=(r>>>0)/4294967296;return Math.floor(s*e)}function ee(e,t){var g;const r=["QB","RB","WR","TE"],s=t[t.length-1],a=Math.max(0,r.indexOf(s??"QB")),n=r.slice(a+1).concat(r.slice(0,a+1)),o=new Map;for(const l of r)o.set(l,[]);for(const l of e)(g=o.get(l.position))==null||g.push(l);const d=[];for(const l of n)d.push(...o.get(l)??[]);return d.length?d:e}export{z as D,H as G,X as H,J as K,Q as T,ee as a,Z as b,_ as c,W as d,q as e,G as i,B as l,Y as r,F as s};
