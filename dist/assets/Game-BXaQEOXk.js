import{R as t,u as p,a as v,i as y,j as s}from"./index-COQNCXdJ.js";import{r as f,i as b,D as N,T as w,G as S,H as k,K as C,l as R,a as T,b as G,s as P}from"./random-B-u04LOh.js";function h(c){const o=R(),a=T(c,o.lastPosition?[o.lastPosition]:[]),i=G(a.length),r=a[i];if(!r)throw new Error("No player found for game");return P({lastPosition:r.position}),r}const M=t.memo(()=>{const c=p(),{status:o,data:a}=v(),[i,r]=t.useState(null),[e,n]=t.useReducer(f,void 0,b);t.useEffect(()=>{var l;(l=a==null?void 0:a.players)!=null&&l.length&&e.tag==="idle"&&r(h(a.players))},[a,e.tag]);const m=t.useCallback(()=>n({type:"start"}),[]),x=t.useCallback(l=>{if(!i||e.tag!=="active")return;const j=y(l,i);n({type:"guess",text:l}),j&&n({type:"reveal",reason:"solved"})},[i,e.tag]),d=t.useCallback(()=>{e.tag==="active"&&n({type:"hint"})},[e.tag]),u=t.useCallback(()=>{e.tag==="active"&&n({type:"reveal",reason:"giveup"})},[e.tag]),g=t.useCallback(()=>{e.tag==="active"&&n({type:"reveal",reason:"timeout"})},[e.tag]);return s.jsxs("div",{className:"container",children:[s.jsx("h1",{children:"Endless Mode"}),s.jsx(N,{}),!o.ready&&s.jsx("div",{className:"card",children:"Loading data…"}),o.ready&&i&&s.jsxs("div",{className:"card",children:[e.tag==="idle"&&s.jsxs("div",{className:"row",children:[s.jsx("button",{onClick:m,children:"Start Round"}),s.jsx("button",{onClick:()=>c("/daily"),children:"Go to Daily"})]}),e.tag==="active"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"grow",children:[s.jsx("strong",{children:"Guess the player"})," — Position: ",s.jsx("em",{children:i.position})]}),s.jsx(w,{deadlineMs:e.deadlineMs,onTimeout:g})]}),s.jsx("div",{className:"row",style:{marginTop:8},children:s.jsx(S,{disabled:!1,onSubmitGuess:x})}),s.jsx("div",{style:{marginTop:8},children:s.jsx(k,{disabled:!1,onHint:d,onGiveUp:u})}),s.jsx("div",{style:{marginTop:8},children:s.jsx(C,{enabled:!0,onSubmit:()=>{},onHint:d,onGiveUp:u})})]}),e.tag==="revealed"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"grow",children:[s.jsxs("h2",{children:["Answer: ",i.displayName]}),s.jsxs("div",{children:["Reason: ",e.reason]})]}),s.jsxs("div",{children:["Final Score: ",s.jsx("strong",{children:e.finalScore}),"/5"]})]}),s.jsxs("div",{className:"row",style:{marginTop:12},children:[s.jsx("button",{onClick:()=>{a!=null&&a.players&&(r(h(a.players)),n({type:"reset"}))},children:"Next Round"}),s.jsx("button",{onClick:()=>window.location.reload(),children:"Reset"})]})]})]})]})});export{M as Game};
