import{a as f,R as i,i as S,j as e,L as h}from"./index-CXctJ39y.js";import{r as k,i as b,e as w,u as D,a as N,b as T,D as C,T as E,G,H as R,K as I,f as F,g as M,s as B}from"./random-CcFizjZ5.js";function H(l){const t=F(new Date),a=M(l.length,t),o=l[a];if(!o)throw new Error("No player found for daily pick");return B({lastDailyKey:t,lastDailyId:o.id}),o}const P=()=>{const{status:l,data:t}=f(),[a,o]=i.useState(null),[s,r]=i.useReducer(k,void 0,b),[m]=i.useState(w()),[d,x]=i.useState({current:0,best:0});i.useEffect(()=>{var n;(n=t==null?void 0:t.players)!=null&&n.length&&s.tag==="idle"&&o(H(t.players))},[t,s.tag]),i.useEffect(()=>{if(s.tag==="revealed"&&a){const n=s.reason==="solved",c=s.endedAtMs-(s.tag==="revealed"&&"guesses"in s?0:Date.now());D(a.position,n,s.finalScore,c>0?c/1e3:void 0);const p=N(n);x(p),T(a.id)}},[s,a]);const y=i.useCallback(()=>r({type:"start"}),[]),j=i.useCallback(n=>{if(!a||s.tag!=="active")return;const c=S(n,a);r({type:"guess",text:n}),c&&r({type:"reveal",reason:"solved"})},[a,s.tag]),u=i.useCallback(()=>{s.tag==="active"&&r({type:"hint"})},[s.tag]),g=i.useCallback(()=>{s.tag==="active"&&r({type:"reveal",reason:"giveup"})},[s.tag]),v=i.useCallback(()=>{s.tag==="active"&&r({type:"reveal",reason:"timeout"})},[s.tag]);return e.jsxs("div",{className:"container",children:[e.jsxs("h1",{children:["Daily â€” ",m]}),e.jsx(C,{}),!l.ready&&e.jsx("div",{className:"card",children:"Loading dataâ€¦"}),l.ready&&a&&e.jsxs("div",{className:"card",children:[s.tag==="idle"&&e.jsxs("div",{className:"row",children:[e.jsx("button",{onClick:y,children:"Start Daily"}),e.jsx(h,{to:"/",children:"Switch to Endless"})]}),s.tag==="active"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"grow",children:[e.jsx("strong",{children:"Guess todayâ€™s player"})," â€” Position: ",e.jsx("em",{children:a.position})]}),e.jsx(E,{deadlineMs:s.deadlineMs,onTimeout:v})]}),e.jsx("div",{className:"row",style:{marginTop:8},children:e.jsx(G,{disabled:!1,onSubmitGuess:j,players:(t==null?void 0:t.players)||[]})}),e.jsx("div",{style:{marginTop:8},children:e.jsx(R,{disabled:!1,onHint:u,onGiveUp:g})}),e.jsx("div",{style:{marginTop:8},children:e.jsx(I,{enabled:!0,onSubmit:()=>{},onHint:u,onGiveUp:g})})]}),s.tag==="revealed"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"grow",children:[e.jsxs("h2",{children:["Answer: ",a.displayName]}),e.jsxs("div",{children:["Reason: ",s.reason]}),d.current>0&&e.jsxs("div",{style:{marginTop:8},children:["ðŸ”¥ Daily Streak: ",e.jsx("strong",{children:d.current})," | Best: ",d.best]})]}),e.jsxs("div",{children:["Final Score: ",e.jsx("strong",{children:s.finalScore}),"/5"]})]}),e.jsxs("div",{className:"row",style:{marginTop:12},children:[e.jsx("button",{onClick:()=>window.location.reload(),children:"Come back tomorrow"}),e.jsx(h,{to:"/",children:"Play Endless"})]})]})]})]})};export{P as Daily};
