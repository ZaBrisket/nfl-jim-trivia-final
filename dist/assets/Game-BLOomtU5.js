import{u as f,a as S,R as n,i as b,j as e}from"./index-CXctJ39y.js";import{r as k,i as N,u as w,a as C,b as T,D as R,T as G,G as P,H as D,K as E,l as M,c as I,d as B,s as F}from"./random-CcFizjZ5.js";function m(d){const l=M(),t=I(d,l.lastPosition?[l.lastPosition]:[]),a=B(t.length),o=t[a];if(!o)throw new Error("No player found for game");return F({lastPosition:o.position}),o}const K=()=>{const d=f(),{status:l,data:t}=S(),[a,o]=n.useState(null),[s,r]=n.useReducer(k,void 0,N),[u,p]=n.useState({current:0,best:0});n.useEffect(()=>{var i;(i=t==null?void 0:t.players)!=null&&i.length&&s.tag==="idle"&&o(m(t.players))},[t,s.tag]),n.useEffect(()=>{if(s.tag==="revealed"&&a){const i=s.reason==="solved",c=s.endedAtMs-(s.tag==="revealed"&&"guesses"in s?0:Date.now());w(a.position,i,s.finalScore,c>0?c/1e3:void 0);const y=C(i);p(y),T(a.id)}},[s,a]);const x=n.useCallback(()=>r({type:"start"}),[]),v=n.useCallback(i=>{if(!a||s.tag!=="active")return;const c=b(i,a);r({type:"guess",text:i}),c&&r({type:"reveal",reason:"solved"})},[a,s.tag]),g=n.useCallback(()=>{s.tag==="active"&&r({type:"hint"})},[s.tag]),h=n.useCallback(()=>{s.tag==="active"&&r({type:"reveal",reason:"giveup"})},[s.tag]),j=n.useCallback(()=>{s.tag==="active"&&r({type:"reveal",reason:"timeout"})},[s.tag]);return e.jsxs("div",{className:"container",children:[e.jsx("h1",{children:"Endless Mode"}),e.jsx(R,{}),!l.ready&&e.jsx("div",{className:"card",children:"Loading dataâ€¦"}),l.ready&&a&&e.jsxs("div",{className:"card",children:[s.tag==="idle"&&e.jsxs("div",{className:"row",children:[e.jsx("button",{onClick:x,children:"Start Round"}),e.jsx("button",{onClick:()=>d("/daily"),children:"Go to Daily"})]}),s.tag==="active"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"grow",children:[e.jsx("strong",{children:"Guess the player"})," â€” Position: ",e.jsx("em",{children:a.position})]}),e.jsx(G,{deadlineMs:s.deadlineMs,onTimeout:j})]}),e.jsx("div",{className:"row",style:{marginTop:8},children:e.jsx(P,{disabled:!1,onSubmitGuess:v,players:(t==null?void 0:t.players)||[]})}),e.jsx("div",{style:{marginTop:8},children:e.jsx(D,{disabled:!1,onHint:g,onGiveUp:h})}),e.jsx("div",{style:{marginTop:8},children:e.jsx(E,{enabled:!0,onSubmit:()=>{},onHint:g,onGiveUp:h})})]}),s.tag==="revealed"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"grow",children:[e.jsxs("h2",{children:["Answer: ",a.displayName]}),e.jsxs("div",{children:["Reason: ",s.reason]}),u.current>0&&e.jsxs("div",{style:{marginTop:8},children:["ðŸ”¥ Current Streak: ",e.jsx("strong",{children:u.current})," | Best: ",u.best]})]}),e.jsxs("div",{children:["Final Score: ",e.jsx("strong",{children:s.finalScore}),"/5"]})]}),e.jsxs("div",{className:"row",style:{marginTop:12},children:[e.jsx("button",{onClick:()=>{t!=null&&t.players&&(o(m(t.players)),r({type:"reset"}))},children:"Next Round"}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Reset"})]})]})]})]})};export{K as Game};
